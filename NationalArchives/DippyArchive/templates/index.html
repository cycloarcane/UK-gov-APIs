<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ðŸŽ² National Archives Lucky Dip</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
/* ------------ core layout ------------ */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
          line-height:1.45;background:#0d1117;color:#f0f6fc}
body{display:flex;justify-content:center;align-items:center;overflow:hidden;position:relative}

/* ------------ matrix background ------------ */
#bg{position:absolute;inset:0;z-index:-1;pointer-events:none;filter:blur(1px) opacity(.25)}

/* ------------ card ------------ */
#card{background:#161b22;border:1px solid #30363d;border-radius:1rem;
      padding:2rem 2.5rem;max-width:46rem;width:90vw;
      box-shadow:0 8px 16px rgba(0,0,0,.45)}
h1{font-size:2rem;margin-bottom:1.2rem;text-align:center}
h2{font-size:1.25rem;margin-bottom:.6rem}
p{margin:.3rem 0}
a{color:#58a6ff;text-decoration:none}
a:hover{text-decoration:underline}
button{margin-top:1.5rem;padding:.7rem 1.4rem;font-size:1rem;
       border:none;border-radius:.5rem;background:#238636;color:#fff;
       cursor:pointer;transition:background .2s}
button:hover{background:#2ea043}
</style>
</head>
<body>

<canvas id="bg"></canvas>

<div id="card">
  <h1>ðŸŽ² Lucky-Dip</h1>
  <h2 id="title">Loadingâ€¦</h2>
  <p><strong>Held by:</strong> <span id="heldBy"></span></p>
  <p id="desc"></p>
  <p><a id="link" target="_blank" rel="noopener">Open in Discovery â†—ï¸Ž</a></p>
  <div style="text-align:center"><button id="roll">Roll again</button></div>
</div>

<script>
/* -------- helper -------- */
const $ = id => document.getElementById(id);

/* -------- archives API -------- */
async function roll(){
  try{
    const r = await fetch('/api/random');
    if(!r.ok) throw new Error(r.status+" "+r.statusText);
    const d = await r.json();
    $('title').textContent  = d.title       || 'Untitled';
    $('heldBy').textContent = d.heldBy      || 'Unknown';
    $('desc').textContent   = d.description || '';
    $('link').href = $('link').textContent = d.url;
  }catch(e){
    $('title').textContent = 'âš ï¸ Error fetching record';
    console.error(e);
  }
}
$('roll').onclick = roll;
roll();

/* -------- â€œ?â€ rain background -------- */
const cv = $('bg'), ctx = cv.getContext('2d');
let W,H,cols,s=20,drops=[];
const chars='????????????????????????????????????????';
function resize(){
  W=cv.width=innerWidth; H=cv.height=innerHeight;
  cols = Math.floor(W/s); drops = Array(cols).fill(1);
}
addEventListener('resize',resize); resize();
(function draw(){
  ctx.fillStyle='rgba(13,17,23,.15)'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#3fb950'; ctx.font=s+'px monospace';
  drops.forEach((y,i)=>{
    ctx.fillText(chars[Math.random()*chars.length|0],i*s,y*s);
    drops[i] = y*s>H && Math.random()>.975 ? 0 : y+1;
  });
  requestAnimationFrame(draw);
})();
</script>
</body>
</html>
